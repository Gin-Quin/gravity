# SvelteKit

## Gravity handler

When using SvelteKit, you define your Gravity handler at `src/hooks.ts`:

```typescript
import { defineHandler } from '@digitak/gravity-svelte-kit/server';

import type { Context } from './services/Context';
import { services } from './services';
import schema from './schema.json';

export const handle = defineHandler<Context>({
  apiPath: "/api",
  services,
  schema,
  // additional options go there
});
```

Now every request made to `/api/...` will be caught by the handler and redirected to the right service.


## Server-side rendering

When using **SvelteKit**, you might want to render pages on server side.

Server-rendering is done inside a **endpoint**, . .

You can perform server-side rendering at two levels:

- at page level with the [load](https://kit.svelte.dev/docs/loading) function,
- at endpoint level with using one of the `get` / `post` / `delete` / ... function. Read more about [SvelteKit endpoints](https://kit.svelte.dev/docs/routing#endpoints)

First, make sure you export the `loader` function in your `api.ts` file:

```typescript
import type { services } from "./services"
import { defineApi } from "@digitak/gravity-svelte-kit"

export const {
  api,
  store,
  handler, // utility for endpoints
  loader, // utility for the load function
} = defineApi<services>({
  // ...
})
```

### Endpoints

You can use the `handler` utility inside any of your endpoint files to access Gravity's services:

```ts
// src/routes/add/[number].ts

export const get = handler(({ api, params })) => {
  const number = parseInt(params.number)
  const sum = await api.math.add(2, number)

  return {
    body: { sum }
  }
})
```

Gravity's **handler** have the same parameters and return type to SvelteKit's [RequestHandler](https://kit.svelte.dev/docs/types#sveltejs-kit-requesthandler) but with an additional `api` parameter.

### Load function

You can use the `loader` utility inside any of your endpoint files to access Gravity's services:


```svelte
<!-- we add context="module" -->
<script context="module" lang="ts">
  import type { ApiResponse } from "@digitak/gravity"
  import { loader } from "src/api"

  interface LoadProps {
    sum: ApiResponse<number>
  }

  export const load = loader(async ({ api, params }) => {
    const sum = await api.math.add(1, 2)
    
    return {
      props: <LoadProps>{
        sum,
      }
    }
  })
</script>

<script lang="ts">
  export let sum: LoadProps["sum"]
</script>

<p>
  <!-- Since we rendered server-side, there is no "loading" state -->
  {#if !result.error}
    Result is: {result.data}
  {/if}
</p>
```

Gravity's **loader** have the same parameters and return type to SvelteKit's [load](https://kit.svelte.dev/docs/loading) function but with an additional `api` parameter.


:::admonition type="tip"
The `load` function is only available for **pages**, ie components inside the `src/routes` directory.
:::
